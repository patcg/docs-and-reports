# Private Measurement Important Dimensions for Attribution

This document serves to identify critical design dimensions the group is considering while evaluating designs for a privacy measurement API focusing on the high-level attribution measurement use-case.
Additionally, we analyze a set of key use-cases that differ based on choices made within these dimensions.

[This document tracks the Design Dimensions that have general agreement from the group.](Dimensions-with-General-Agreement.md)

# Glossary
* ARA: [Attribution Reporting API](https://github.com/wicg/attribution-reporting-api), a measurement proposal from Google, currently in Origin Trials
    * E-ARA: ARA with [event-level reports](https://github.com/WICG/attribution-reporting-api/blob/main/EVENT.md)
    * A-ARA: ARA with [aggregatable reports](https://github.com/WICG/attribution-reporting-api/blob/main/AGGREGATE.md)
* IPA: [Interoperable Private Attribution](https://github.com/patcg-individual-drafts/ipa), a joint proposal between Meta and Mozilla
* PCM: [Private Click Measurement](https://github.com/privacycg/private-click-measurement), a measurement API shipped in Safari.
* SKAN: [SkAdNetwork](https://developer.apple.com/documentation/storekit/skadnetwork/), a measurement API shipped in iOS to measure app install conversions
* [Avail](https://cimm-us.org/dictionary/ad-avails/): an “opportunity” for an ad placement for an advertiser.

# Major dimensions

These dimensions drastically change the architecture of the API, and nature of its output. Different choices on these axes will:

* Likely lead to entirely different overall designs
* More likely lead to non-interoperable designs
* Directly impact minor dimensions

| Dimension                          | Description                                                                                         | Where do existing proposals stand?                                                                                                                                                                                                                                                                                |
|------------------------------------|-----------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Server mediated                    | Whether the API makes use of a server to compute the output                                         | PCM: No<br>E-ARA: No<br>A-ARA: Yes<br>IPA: Yes<br>SKAN: Yes                                                                                                                                                                                                                                                           |
| Privacy definition of API output   | [Differential privacy](https://en.wikipedia.org/wiki/Differential_privacy), information theoretic (e.g. [entropy](https://en.wikipedia.org/wiki/Entropy_(information_theory))), [k-anonymity](https://en.wikipedia.org/wiki/K-anonymity)                             | PCM: information theoretic<br>E-ARA: local DP + information theoretic<br>A-ARA: central DP + information theoretic<br>IPA: central DP<br>SKAN: Combination of information theoretic + k-anonymity|
| On-device / off-device attribution | Whether join/attribution occurs on-device or in a server                                            | PCM: device<br>E-ARA: device<br>A-ARA: device<br>IPA: server<br>SKAN: device                                                                                                                                                                                                                                      |
| Where is budgeting applied         | Where are user contributions bounded within the above scope?                                        | PCM: on-device<br>E-ARA: on-device<br>A-ARA: hybrid on-device and in servers<br>IPA: servers<br>SKAN: on-device                                                                                                                                                                                                   |
| Scope of attribution               | Do we support attribution across channels / ad-tech?                                                | PCM: No<br>E-ARA: Yes - within a given an ad-network<br>A-ARA: Yes - within a given an ad-network<br>IPA: Yes<br>SKAN: Yes                                                                                                                                                                                        |


# Minor, but important dimensions

These design dimensions may critically impact some use-cases, but they do not drastically change the architecture of the API.
It is possible to consider some differences in these dimensions while maintaining interoperability.
Additionally, some of these dimensions are influenced entirely by some of the major dimensions.

| Dimension                                                                                    | Description                                                                                                                                                                                                                           | Where do existing proposals stand?                                                                                                                                                                                                                                                                                       |
|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Scope of privacy budgeting         | If applicable, the axes along which privacy budgeting applies: time epoch, site, campaign, delegate | PCM: Per device/source-destination site pair. Limited in rate by reporting delay and user interaction.<br>A-ARA: Per epoch, source ⇔ destination site pair, device.<br>E-ARA: Per epoch, source ⇔ destination site pair, device<br>IPA: Per week/epoch, per site, per match key.<br>SKAN: Per device / source app |
| Cross device & device graph                                                                  | Can events on device A be linked to events on device B? How is the device graph maintained and used?                                                                                                                                  | PCM: No<br>E-ARA: Only with cross-device, same-vendor sync (w/ early stage proposal)<br>A-ARA: Only with cross-device, same-vendor sync (w/ early stage proposal)<br>IPA: Yes. Graph is maintained by sites setting<br>SKAN: No                                                                                          |
| Same device cross environment                                                                | Can events on device A be linked to events on device A across different applications?                                                                                                                                                 | PCM: App → Web/SFSafariViewController, Web → App<br>E-ARA: Partial w/ platform support<br>A-ARA: Partial w/ platform support<br>IPA: Yes<br>SKAN: No                                                                                                                                                    |
| Security guarantees of the agg infra                                                         | What kind of aggregation service would we want to support? What security properties would it need it have?                                                                                                                            | PCM: N/A<br>E-ARA: N/A<br>A-ARA: TEE w/ multi-party key holder (previously two-party MPC)<br>IPA: three-party MPC<br>SKAN: Trusted platform-owned servers (app store)                                                                                                                                                    |
| Stance on third party measurement providers / delegation                                     | Can multiple third parties measure the same events ? How are they restricted? Can third party code even invoke the API?                                                                                                               | PCM: No, disallowed in iframes, etc.<br>E-ARA: Each pair of source ⇔ destination sites can delegate to a limited number of delegates. <br>A-ARA: Each pair of source ⇔ destination sites can delegate to a limited number of delegates. <br>IPA: Sites can apportion their budget across multiple delegates.<br>SKAN: No |
| Allowed input events                                                                         | Clicks vs. views vs. avails vs. events from outside the platform/browser. Other restrictions on events (verifiable views/clicks, particular conversions, etc)                                                                         | PCM: Clicks<br>E-ARA: Clicks + Views/Avails<br>A-ARA: Clicks + Views /Avails<br>IPA: Clicks / Views / Avails + Offline Events<br>SKAN: Views only except for StoreKit ads                                                                                                                                                |
| Time delay before reporting from the client                                                  | Does the privacy of the mechanism rely on a delay from the client before being sent to the report collector?                                                                                                                          | PCM: Yes: 24-48h delay<br>E-ARA: Yes: 2d1h or 7d1h or N+1h delay<br>A-ARA: Yes: 1h delay, but reducible to 0 with minor tweaks<br>IPA: No delaySKAN: Yes: 24-48h delay, SKAN 4.0 has multiple windows                                                                                                                    |
| Prior configuration                                                                          | What sort of a priori arrangements or commitments need to be made by parties., e.g. in the form of publishing a configuration file or a commitment to use a specific helper service, etc. Which parties need to make this commitment? | PCM: none<br>E-ARA: none<br>A-ARA: none<br>IPA: report collectors make a weekly commitment to a helper / delegate<br>SKAN: Pre-registration of ad network for [source apps](https://developer.apple.com/documentation/storekit/skadnetwork/configuring_a_source_app), ad networks need to [enroll](https://developer.apple.com/documentation/storekit/skadnetwork/registering_an_ad_network) with Apple|
| Structural support (in theory) for more sophisticated privacy mechanism, to optimize utility | E.g. for differential privacy:<br>Advanced composition<br>Matrix mechanism<br>Above threshold / Sparse vector technique<br>etc                                                                                                        | PCM: No<br>E-ARA: Minimal (local only)<br>A-ARA: Partial<br>IPA: In principle, yes<br>SKAN: No                                                                                                                                                                                                                           |

# Key use-cases that differ

There are a number of important measurement use-cases that are affected by the above design dimensions.
The following is a (non-exhaustive) list, along with which dimensions affects them.

| Use-case                                                                                                                                                                    | Proposal Support Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Key related dimension(s)                                                                                                                                                |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [View-through](https://github.com/w3c/web-advertising/blob/main/support_for_advertising_use_cases.md#click-through-and-view-through-attribution-heuristics) / [Conversion-Lift](https://github.com/w3c/web-advertising/blob/main/support_for_advertising_use_cases.md#conversion-lift-measurement) / Avails / return-on-ad-spend aggregate measurement                                                                                          | PCM: No, only supports click events.<br>E-ARA: Yes<br>A-ARA: Yes<br>IPA: Yes<br>SKAN: Yes                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Allowed input events<br>Privacy definition of API output|
| Delegating ad serving & measurement to a service-provider                                                                                                                   | PCM: No<br>E-ARA: Yes<br>A-ARA: Yes<br>IPA: Yes<br>SKAN: Yes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Stance on third party measurement providers / delegation<br>Scope of budgeting                                                                                          |
| [Optimization](https://github.com/w3c/web-advertising/blob/main/support_for_advertising_use_cases.md#training-ml-models), e.g.<br>Predicted conversion rate (pCVR)<br>Predicted value (pValue) to optimize return on ad spend                                                           | PCM: No<br>E-ARA: Partial (no pValue support)<br>A-ARA: Potentially in future<br>IPA: Potentially in future<br>SKAN: No                                                                                                                                                                                                                                                                                                                                                                                                                            | Privacy definition of API output<br>Time delay before reporting from the client<br>Security guarantees of the agg infra<br>Trigger breakdown support<br>Server mediated |
| “Real time” [Budget steering](https://github.com/w3c/web-advertising/blob/main/support_for_advertising_use_cases.md#real-time-spend-management) / monitoring (for CPA billing)                                                                                                                  | PCM: No<br>E-ARA: No<br>A-ARA: Partial<br>IPA: Partial<br>SKAN: No                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Privacy definition of API output<br>Server mediated<br>Time delay before reporting from the client|
| Cross environment attribution. Attribution works across {App, Web, Webview, Offline} contexts, including [across devices](https://github.com/w3c/web-advertising/blob/main/support_for_advertising_use_cases.md#cross-browser--cross-device-measurement). | PCM: App → Web/SFSVC, Web → App<br>E-ARA: Same-device across app and web<br>A-ARA: Same-device across app and web<br>IPA: Potentially everything<br>SKAN: No | Server-mediated<br>On-device / off-device attribution<br>Cross device & device graph |
| [Attribution models](https://github.com/w3c/web-advertising/blob/main/support_for_advertising_use_cases.md#multi-touch-attribution) other than last-touch (rules-based / data driven)                                                                                                 | PCM: No<br>ARA: Partial (priority based)<br>IPA: Potentially in the future<br>SKAN: No<br>Data-driven: No for all                                                                                                                                                                                                                                                                                                                                                                                                                                  ||
| [Spam / fraud filtering](https://github.com/w3c/web-advertising/blob/main/support_for_advertising_use_cases.md#fraud-prevention)                                                                                                                                               | PCM: Token-based (online filtering)<br>E-ARA: Partial (online source filtering)<br>A-ARA: Partial (online trigger filtering, token-based, early stage)<br>IPA: online & offline source and trigger filtering<br>SKAN: Device attestation                                                                                                                                                                                                                                                                                                           | On-device / off-device attribution<br>Privacy definition<br>Time delay|
| Multiple triggers per source. Marketers want to report on not only sales, but also sessions, baskets… all in accurate ways.                                                 | PCM: max of 1 attributed conversion per source event<br>E-ARA: Views: max of 1 attributed conversion per source event; Clicks: more than 1<br>A-ARA: more than 1<br>IPA: more than 1<br>SKAN: No (just a single install)                                                                                                                                                                                                                                                                                                                           | Privacy definition<br>Server mediated                                                                                                                                   |
| Trigger breakdown support. What options are available for managing different types of attribution on the trigger side?                                                      | PCM: each trigger carries 4 bits of information<br>E-ARA: 3 bits (click) or 1 bit (view/avail) w/ noise<br>A-ARA: Potential to construct rich keys based on both source and trigger side data<br>IPA: None in current proposal except value, but potential in the future to construct rich keys based on trigger side data<br>SKAN: 6 bit value; SKAN 4.0 has hierarchical source identifiers (2, 3 or 4 digits) and hierarchical conversion values (6-bit or [low, medium, high] – level of information available is based on size of event pool. | Privacy definition<br>Server mediated                                                                                                                                   |
| Flexible attribution windows. Whether there is a fixed or configurable period for  attribution events.                                                                      | PCM: Fixed<br>E-ARA: Flexible<br>A-ARA: Flexible<br>IPA: Flexible<br>SKAN: In SKAN 4.0                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Privacy definition<br>Time delay<br>On-device / off-device attribution                                                                                                  |
